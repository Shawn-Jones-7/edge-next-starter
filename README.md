# B2B ä¼ä¸šå®˜ç½‘

åŸºäº Next.js + Cloudflare çš„ B2B ä¼ä¸šå®˜ç½‘é¡¹ç›®ï¼Œæ”¯æŒå…¨çƒè¾¹ç¼˜éƒ¨ç½²ã€å†…å®¹å±•ç¤ºå’Œè¯¢ç›˜ç®¡ç†ã€‚

## æŠ€æœ¯æ ˆ

| æŠ€æœ¯             | ç‰ˆæœ¬ | ç”¨é€”                          |
| ---------------- | ---- | ----------------------------- |
| Next.js          | 15.5 | App Router + Edge Runtime     |
| Cloudflare Pages | -    | å…¨çƒè¾¹ç¼˜éƒ¨ç½²                  |
| D1 Database      | -    | SQLite è¾¹ç¼˜æ•°æ®åº“ï¼ˆè¯¢ç›˜ç®¡ç†ï¼‰ |
| R2 Storage       | -    | å¯¹è±¡å­˜å‚¨ï¼ˆå›¾ç‰‡/è§†é¢‘/PDFï¼‰     |
| KV Storage       | -    | é”®å€¼ç¼“å­˜                      |
| Tailwind CSS     | 3.4  | æ ·å¼æ¡†æ¶                      |
| TypeScript       | 5.9  | ç±»å‹å®‰å…¨                      |

## æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½       | çŠ¶æ€      | è¯´æ˜                           |
| ---------- | --------- | ------------------------------ |
| å†…å®¹å±•ç¤º   | âœ… å¯ç”¨   | æ”¯æŒå›¾ç‰‡ã€è§†é¢‘ã€PDF ç­‰æ–‡ä»¶å±•ç¤º |
| è¯¢ç›˜è·å–   | ğŸš§ å¼€å‘ä¸­ | è”ç³»è¡¨å• + çº¿ç´¢ç®¡ç†            |
| å¤šè¯­è¨€æ”¯æŒ | ğŸ“‹ è®¡åˆ’ä¸­ | ä¸­è‹±æ–‡åˆ‡æ¢                     |

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 20.0.0
- pnpm >= 8.0.0
- Cloudflare è´¦æˆ·

### å®‰è£…æ­¥éª¤

```bash
# 1. å®‰è£…ä¾èµ–
pnpm install

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.local.example .env.local
cp .dev.vars.example .dev.vars

# 3. æ‰§è¡Œæ•°æ®åº“è¿ç§»
pnpm db:migrate:local

# 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev
```

### Cloudflare èµ„æºåˆ›å»º

```bash
# åˆ›å»º D1 æ•°æ®åº“
pnpm db:create:test   # æµ‹è¯•ç¯å¢ƒ
pnpm db:create:prod   # ç”Ÿäº§ç¯å¢ƒ

# åˆ›å»º R2 å­˜å‚¨æ¡¶
pnpm r2:create:test
pnpm r2:create:prod

# åˆ›å»º KV å‘½åç©ºé—´
pnpm kv:create:test
pnpm kv:create:prod
```

## é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ api/               # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ health/       # å¥åº·æ£€æŸ¥
â”‚   â”‚   â””â”€â”€ upload/       # æ–‡ä»¶ä¸Šä¼ 
â”‚   â”œâ”€â”€ privacy/          # éšç§æ”¿ç­–
â”‚   â”œâ”€â”€ terms/            # æœåŠ¡æ¡æ¬¾
â”‚   â”œâ”€â”€ page.tsx          # é¦–é¡µ
â”‚   â””â”€â”€ layout.tsx        # æ ¹å¸ƒå±€
â”œâ”€â”€ components/            # React ç»„ä»¶
â”‚   â””â”€â”€ ui/               # åŸºç¡€ UI ç»„ä»¶
â”œâ”€â”€ lib/                   # æ ¸å¿ƒåº“
â”‚   â”œâ”€â”€ api/              # API å·¥å…·ï¼ˆå“åº”æ ¼å¼ã€ä¸­é—´ä»¶ï¼‰
â”‚   â”œâ”€â”€ db/               # D1 æ•°æ®åº“å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ r2/               # R2 å­˜å‚¨å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ cache/            # KV ç¼“å­˜å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ errors/           # ç»Ÿä¸€é”™è¯¯å¤„ç†
â”‚   â”œâ”€â”€ logger/           # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ http/             # HTTP å®¢æˆ·ç«¯ï¼ˆå¤–éƒ¨ APIï¼‰
â”‚   â””â”€â”€ rate-limiter/     # é€Ÿç‡é™åˆ¶
â”œâ”€â”€ repositories/          # æ•°æ®ä»“åº“å±‚
â”‚   â””â”€â”€ lead.repository.ts # è¯¢ç›˜æ•°æ®ä»“åº“
â”œâ”€â”€ services/              # ä¸šåŠ¡æœåŠ¡å±‚
â”œâ”€â”€ migrations/            # D1 æ•°æ®åº“è¿ç§»
â”œâ”€â”€ prisma/                # Prisma Schema
â”œâ”€â”€ docs/                  # æŠ€æœ¯æ–‡æ¡£ï¼ˆä¸­æ–‡ï¼‰
â””â”€â”€ __tests__/             # æµ‹è¯•æ–‡ä»¶
```

## å¸¸ç”¨å‘½ä»¤

### å¼€å‘

```bash
pnpm dev              # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm build            # æ„å»ºåº”ç”¨
pnpm start            # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
```

### ä»£ç è´¨é‡

```bash
pnpm type-check       # TypeScript ç±»å‹æ£€æŸ¥
pnpm lint             # ESLint æ£€æŸ¥
pnpm lint:fix         # ESLint è‡ªåŠ¨ä¿®å¤
pnpm format:write     # Prettier æ ¼å¼åŒ–
```

### æµ‹è¯•

```bash
pnpm test             # è¿è¡Œæµ‹è¯•
pnpm test:coverage    # æµ‹è¯•è¦†ç›–ç‡
```

### æ•°æ®åº“

```bash
pnpm db:migrate:local # æœ¬åœ°è¿ç§»
pnpm db:migrate:test  # æµ‹è¯•ç¯å¢ƒè¿ç§»
pnpm db:migrate:prod  # ç”Ÿäº§ç¯å¢ƒè¿ç§»
pnpm prisma:generate  # ç”Ÿæˆ Prisma å®¢æˆ·ç«¯
```

### éƒ¨ç½²

```bash
pnpm pages:deploy          # éƒ¨ç½²åˆ° Cloudflare
pnpm pages:deploy:test     # éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
pnpm pages:deploy:prod     # éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
```

## æ•°æ®æ¨¡å‹

### Leadï¼ˆè¯¢ç›˜/çº¿ç´¢ï¼‰

ç”¨äºå­˜å‚¨è”ç³»è¡¨å•æäº¤çš„è¯¢ç›˜æ•°æ®ã€‚

| å­—æ®µ      | ç±»å‹   | å¿…å¡« | è¯´æ˜                                                   |
| --------- | ------ | ---- | ------------------------------------------------------ |
| id        | Int    | è‡ªåŠ¨ | ä¸»é”®                                                   |
| name      | String | âœ…   | è”ç³»äººå§“å                                             |
| email     | String | âœ…   | è”ç³»é‚®ç®±                                               |
| phone     | String | -    | è”ç³»ç”µè¯                                               |
| company   | String | -    | å…¬å¸åç§°                                               |
| subject   | String | -    | å’¨è¯¢ä¸»é¢˜                                               |
| message   | String | âœ…   | å’¨è¯¢å†…å®¹                                               |
| source    | String | -    | æ¥æºæ¸ é“ï¼ˆcontact_form/landing_pageï¼‰                  |
| status    | String | è‡ªåŠ¨ | çŠ¶æ€ï¼šnew â†’ contacted â†’ qualified â†’ converted â†’ closed |
| locale    | String | -    | æäº¤æ—¶çš„è¯­è¨€                                           |
| ipAddress | String | è‡ªåŠ¨ | IP åœ°å€ï¼ˆé˜²åƒåœ¾ï¼‰                                      |
| userAgent | String | è‡ªåŠ¨ | æµè§ˆå™¨ä¿¡æ¯                                             |
| createdAt | Int    | è‡ªåŠ¨ | åˆ›å»ºæ—¶é—´æˆ³                                             |
| updatedAt | Int    | è‡ªåŠ¨ | æ›´æ–°æ—¶é—´æˆ³                                             |

## æŠ€æœ¯æ–‡æ¡£

| æ–‡æ¡£                                  | è¯´æ˜                |
| ------------------------------------- | ------------------- |
| [æ¶æ„è¯´æ˜](./docs/ARCHITECTURE-zh.md) | é¡¹ç›®æ•´ä½“æ¶æ„è®¾è®¡    |
| [å¼€å‘æŒ‡å—](./docs/DEVELOPMENT-zh.md)  | æœ¬åœ°å¼€å‘æµç¨‹        |
| [éƒ¨ç½²æŒ‡å—](./docs/DEPLOYMENT-zh.md)   | Cloudflare éƒ¨ç½²æµç¨‹ |
| [ç¯å¢ƒé…ç½®](./docs/ENVIRONMENTS-zh.md) | ç¯å¢ƒå˜é‡å’Œç»‘å®šé…ç½®  |

## ç¯å¢ƒå˜é‡

### .env.localï¼ˆæœ¬åœ°å¼€å‘ï¼‰

```bash
# å¿…é¡»é…ç½®
NEXT_PUBLIC_SITE_URL=http://localhost:3000
```

### .dev.varsï¼ˆCloudflare å¼€å‘ï¼‰

å‚è€ƒ `.dev.vars.example` é…ç½® Cloudflare ç»‘å®šã€‚

## å¼€å‘è·¯çº¿å›¾

### Phase 1ï¼šåŸºç¡€åŠŸèƒ½ï¼ˆå½“å‰ï¼‰

- [x] é¡¹ç›®æ¸…ç†å’Œç»“æ„è°ƒæ•´
- [x] Lead æ•°æ®æ¨¡å‹
- [ ] è”ç³»è¡¨å•é¡µé¢
- [ ] è”ç³»è¡¨å• API
- [ ] è¯¢ç›˜é‚®ä»¶é€šçŸ¥

### Phase 2ï¼šå¤šè¯­è¨€æ”¯æŒ

- [ ] next-intl é›†æˆ
- [ ] ä¸­è‹±æ–‡è·¯ç”±
- [ ] è¯­è¨€åˆ‡æ¢ç»„ä»¶

### Phase 3ï¼šå†…å®¹é¡µé¢

- [ ] é¦–é¡µé‡æ„
- [ ] äº§å“/æœåŠ¡é¡µé¢
- [ ] æ¡ˆä¾‹å±•ç¤ºé¡µé¢
- [ ] å…³äºæˆ‘ä»¬é¡µé¢

### Phase 4ï¼šè¯¢ç›˜ç®¡ç†

- [ ] é”€å”®é€šçŸ¥é›†æˆï¼ˆé£ä¹¦/ä¼ä¸šå¾®ä¿¡ï¼‰
- [ ] ç®€æ˜“åå°ç®¡ç†
- [ ] æ•°æ®å¯¼å‡ºåŠŸèƒ½
